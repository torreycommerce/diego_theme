function ajaxCart(t,o){console.log("AjaxCart"),console.log(t);var a=!0,e,r=0,i=0,c=$.parseJSON(t),n=!0;for(key in c)n=n&&c[key];return n?void $.ajax({dataType:"json",url:acendaBaseUrl+"/api/sessioncart"}).done(function(t){e=t.result.items,r=t.result.item_count,i=t.result.subtotal,console.log(t)}).then(function(t){var c=[],n=[],l=!1,u=[],p=[],s=[];if(p=a?e:$("#productForm").serializeArray(),$(".mobile-popover .ajaxcart-product:gt(0), .cart .ajaxcart-product:gt(0)").remove(),0==p.length)return void($("div.mobile-popover").is(":hidden")||$("div.mobile-popover").attr("data-content",'<div class="popover-close"><div class="row"><div class="col-md-12"><a onclick="$(\'li.cart\').popover(\'hide\')" id="ajaxcart-close" class="btn btn-danger btn-sm pull-right fa fa-times"></a></div></div></div><h5>Your cart is empty.</h5>').popover("show"));for(var d=0;d<p.length;d++){s[p[d].product_id]=d;var m,v,h;if(a)m=p[d],v=m.quantity,h=m.product_id;else{if(m=p[d],v=m.value,""==v&&(v=1),0==v)continue;h=m.name.match(/\[(.*?)\]/)[1]}u[h]={quantity:v};var f=$.getJSON(acendaBaseUrl+"/api/variant/"+h).done(function(t){n.push(t.result)});c.push(f)}var b=$.when.apply($,c);b.done(function(){n.sort(function(t,o){return s[t.id]>s[o.id]});for(var t=0;t<n.length;t++){var c=n[t].title,p=parseFloat(n[t].price).toFixed(2),d=n[t].thumbnail,m=n[t].id;if(l){var v=$(".ajaxcart-product:last").clone().appendTo(".mobile-popover .ajaxcart-products, .cart .ajaxcart-products");v.find(".product-image").attr("src",d),v.find(".product-name").html(c),v.find(".product-price").html(p),v.find(".product-quantity").html(u[m].quantity)}else $(".ajaxcart-product .product-image").attr("src",d),$(".ajaxcart-product .product-name").html(c),$(".ajaxcart-product .product-price").html(p),$(".ajaxcart-product .product-quantity").html(u[m].quantity),l=!0}$(".cart .item-count, .toolbar-mobile .item-count, #nav-mobile-main .item-count").html(r),$(".cart .ajaxcart .item-count, .mobile-popover .ajaxcart .item-count").html(r),$(".cart .ajaxcart .subtotal, .mobile-popover .ajaxcart .subtotal").html(i),$(".cart .ajaxcart .heading, .mobile-popover .ajaxcart .heading").html(a?"":"The following item(s) were added to your cart:"),$("#collection .quantity-selector").val(0),e.length>0&&displayCart($("li.cart").attr("data-content",$(".cart .ajaxcart").html()),o)})}):void $("li.cart").attr("data-content","<h5></h5>").popover("show")}function displayCart(t,o){t.popover("show"),t.on("shown.bs.popover",function(){$(this).parent().find("div.popover-content").mouseenter(function(){cartCloseTimeout&&clearTimeout(cartCloseTimeout)}).mouseleave(function(){cartCloseTimeout&&clearTimeout(cartCloseTimeout),setTimeout(function(){t.popover("hide")},500)})}),cartCloseTimeout=setTimeout(function(){t.popover("hide")},5e3)}var cartCloseTimeout,cartTriggerTimeout;$(function(){$("li.cart").popover("show");var t=!1;$("li.cart").hover(function(){t=!0,$(".popover.fade.bottom.in").length||cartTriggerTimeout||(cartTriggerTimeout=setTimeout(function(){t&&(""==$("li.cart").attr("data-content")?ajaxCart("{}",!0):($("li.cart").popover("show"),cartCloseTimeout=setTimeout(function(){$("li.cart").popover("hide")},5e3))),cartTriggerTimeout=!1},500))},function(){t=!1}),$.getJSON(acendaBaseUrl+"/api/sessioncart",function(t){console.log(t),$(".cart .item-count, div.toolbar-mobile .item-count").html(t.result.item_count)}),$("li.cart, div.mobile-popover").popover({html:!0,trigger:"manual",placement:"bottom"})}),$("#ajaxcart-close").click(function(){$("div.popover-content").popover("hide")}),$("button[value=cart]").click(function(t){t.preventDefault();var o=0;return $("#productForm .quantity-selector").each(function(){isNaN($(this).val())||(o+=parseInt($(this).val()))}),0===o?(alert("Need to enter a quantity!"),!1):($("button[value=cart]").attr("disabled",!0),void $.post(acendaBaseUrl+"/product/route",$("#productForm").serialize()).always(function(t){$("button[value=cart]").attr("disabled",!1),$("html, body").animate({scrollTop:0},600)}).fail(function(){$("li.cart, div.mobile-popover").attr("data-content","<h5>Failed to add item(s) to cart.</h5>").popover("show")}).success(ajaxCart))});